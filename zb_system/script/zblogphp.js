!function(){var t=["comment.verifydata","comment.postsuccess","comment.posterror"],e={"comment.reply":"comment.reply.start","userinfo.savefromhtml":"userinfo.readFromHtml"},n=function(n,i){if("undefined"==typeof jQuery&&void 0===i)throw new Error("No jQuery!");this.$=i||window.jQuery,Object.keys||(Object.keys=function(t){return this.$.map(t,function(t,e){return e})}),console||(window.console={},console.logs=[],console.log=console.error=console.warn=function(){console.logs.push(arguments)}),t=t.concat(Object.keys(e));var r=this;return o(this),(n=n||{}).cookiepath=n.cookiepath||"/",n.bloghost=n.bloghost||location.origin,n.ajaxurl=n.ajaxurl||location.origin,n.commentmaxlength=n.commentmaxlength||1e3,n.lang=n.lang||{},n.comment=n.comment||{},n.comment.inputs=n.comment.inputs||{},n.comment.useDefaultEvents=n.comment.useDefaultEvents||!1,this.eachOnCommentInputs=function(t){return r.$.each(n.comment.inputs,t)},this.eachOnCommentInputs(function(t,e){!e.getter&&e.selector&&(e.getter=function(){return r.$(e.selector).val()}),!e.setter&&e.selector&&(e.setter=function(t){return r.$(e.selector).val(t)}),e.validator||(e.validator=function(t,n){for(t=t||e.getter();;){if(""===(t=(t=t||"").toString().trim())){if(e.required)break;return n(null)}if(e.validateRule&&(e.validateRule.lastIndex=0,!e.validateRule.test(t)))break;return n(null)}var o=new Error(e.validateFailedMessage||r.options.lang.error[e.validateFailedErrorCode]);return o.code=e.validateFailedErrorCode,n(o)})}),this.options=n,this.plugin.on("userinfo.output","system",function(){r.eachOnCommentInputs(function(t,e){e.saveLocally&&e.setter(r.userinfo[t])})}),this.plugin.on("userinfo.readFromHtml","system",function(){r.eachOnCommentInputs(function(t,e){e.saveLocally&&(r.userinfo[t]=e.getter())}),r.userinfo.save()}),this.plugin.on("userinfo.save","system",function(){r.eachOnCommentInputs(function(t,e){e.saveLocally&&(r.userinfo[t]=e.getter(),r.cookie.set("zbp_userinfo_"+t,r.userinfo[t]))})}),this.plugin.on("comment.get","system",function(t,e){r.$.get(r.options.bloghost+"zb_system/cmd.php?act=getcmt&postid="+t+"&page="+e,function(n,o,i){r.plugin.emit("comment.got",[t,e],n,o,i)})}),this.plugin.on("comment.post.validate","system",function(t){var e=0,n=!1,o=function(o){if(!n){if(o)return n=!0,void r.plugin.emit("comment.post.validate.error",o,t);if(++e===Object.keys(r.options.comment.inputs).length){var i={no:0,msg:""};if(r.plugin.emit("comment.verifydata",i,t),i.no>0)return(o=new Error(i.msg)).code=i.no,void r.plugin.emit("comment.post.validate.error",o,t);r.plugin.emit("comment.post.validate.success",t)}}};r.eachOnCommentInputs(function(e,n){n.validator(t[e],o)})}),this.plugin.on("comment.post.start","system",function(t){r.eachOnCommentInputs(function(e,n){t[e]=t[e]||n.getter()}),t.commentKey=(new Date).getTime()+""+Math.random(),r.plugin.emit("comment.post.validate",t)}),this.plugin.on("comment.post.validate.error","system",function(t,e){r.plugin.emit("comment.post.error",t,e)}),this.plugin.on("comment.post.validate.success","system",function(t){r.$.post(t.action,t).done(function(e,n,o){r.plugin.emit("comment.postsuccess",t,e,n,o);var i=r.$.parseJSON(e);if(i.err&&i.err.code>0){var s=new Error(i.err.msg);s.code=i.err.code,r.plugin.emit("comment.post.error",s,t,i,n,o)}else r.plugin.emit("comment.post.success",t,i,n,o)}).fail(function(e,n){var o=new Error(n);o.code=255,r.plugin.emit("comment.post.error",o,t,n,e)})}),this.plugin.on("comment.post.success","system",function(t,e,n,o){r.plugin.emit("comment.post.done",null,t,e,n,o)}),this.plugin.on("comment.post.error","system",function(t,e,n,o,i){r.plugin.emit("comment.posterror",{jqXHR:i,msg:t.message,code:t.code},e),r.plugin.emit("comment.post.done",t,e,n,o,i)}),this.options.comment.useDefaultEvents&&(this.plugin.on("comment.reply.start","system-default",function(t){this.$("#inpRevID").val(t),this.$("#cancel-reply").show().bind("click",function(){return r.plugin.emit("comment.reply.cancel"),r.$("#inpRevID").val(0),r.$(this).hide(),window.location.hash="#comment",!1}),window.location.hash="#comment"}),this.plugin.on("comment.got","system-default",function(t,e,n,o){this.$("#AjaxCommentBegin").nextUntil("#AjaxCommentEnd").remove(),this.$("#AjaxCommentBegin").after(e)}),this.plugin.on("comment.post.start","system-default",function(){var t=r.$("#inpId").parent("form").find(":submit");t.data("orig",t.val()).val("Waiting...").attr("disabled","disabled").addClass("loading")}),this.plugin.on("comment.post.done","system-default",function(t){var e=r.$("#inpId").parent("form").find(":submit");e.removeClass("loading").removeAttr("disabled"),e.data("orig")&&e.val(e.data("orig"))}),this.plugin.on("comment.post.success","system-default",function(t,e,n,o){"0"===t.replyid.toString()?this.$(e.data.html).insertAfter("#AjaxCommentBegin"):this.$(e.data.html).insertAfter("#AjaxComment"+t.replyid),location.hash="#cmt"+e.data.ID,this.$("#txaArticle").val(""),this.userinfo.readFromHtml()}),this.plugin.on("comment.post.error","system-default",function(t){throw alert(t.message),new Error("ERROR - "+t.message)})),this};n.prototype._plugins={};var o=function(n){n.utils={},n.utils.getFromIndex=function(t,e){for(var n=[],o=t;o<e.length;o++)n.push(e[o]);return n};var o=function(){};o.prototype.checkIsInterfaceDeprecated=function(e){return t.indexOf(e)>=0&&(console.warn("Interface '"+e+"' is deprecated in ZBP 1.6, please update your plugin or theme!"),!0)},o.prototype.bind=o.prototype.on=o.prototype.addListener=function(t,o,i){return this.checkIsInterfaceDeprecated(t)&&e[t]&&(t=e[t]),void 0===n._plugins[t]&&(n._plugins[t]={}),n._plugins[t][o]=i,n},o.prototype.unbind=o.prototype.removeListener=function(t,o){return o||(o=""),this.checkIsInterfaceDeprecated(t)&&"system"===o&&(o="system-default",e[t]&&(t=e[t])),""===o?n._plugins[t]={}:n._plugins[t]&&(n._plugins[t][o]=null,delete n._plugins[t][o]),n},o.prototype.emit=function(t){var e=n.utils.getFromIndex(1,arguments);for(var o in n._plugins[t])n._plugins[t][o].apply(n,e);return n},o.prototype.listenerCount=function(t){return Object.keys(n._plugins[t])},n.plugin=new o;var i=function(){};i.prototype.get=function(t){var e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]*)(;|$)"));return e?unescape(e[2]):null},i.prototype.set=function(t,e,o){var i=new Date;return o&&i.setTime(i.getTime()+parseInt(24*o*60*60*1e3)),document.cookie=t+"="+escape(e)+"; "+(o?"expires="+i.toGMTString()+"; ":"")+"path="+n.options.cookiepath,n},n.cookie=new i;var r=function(){};r.prototype.output=function(){return n.plugin.emit("userinfo.output"),n},r.prototype.save=function(){return n.plugin.emit("userinfo.save"),n},r.prototype.saveFromHtml=r.prototype.readFromHtml=function(){return n.plugin.emit("userinfo.readFromHtml"),n},n.userinfo=new r;var s=function(){};s.prototype.get=function(t,e){n.plugin.emit("comment.get",t,e)},s.prototype.reply=function(t){n.plugin.emit("comment.reply.start",t)},s.prototype.post=function(t){t=t||{};try{n.plugin.emit("comment.post.start",t)}catch(t){console.error(t)}return!1},n.comment=new s};"function"==typeof define&&define.amd?define("zbp",[],function(){return n}):"function"==typeof define&&define.cmd?define("zbp",[],function(t,e,o){o.exports=n}):"undefined"!=typeof module?module.exports=n:window.ZBP=n}();